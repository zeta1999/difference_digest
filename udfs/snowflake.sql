CREATE OR REPLACE FUNCTION F_DD_64BIT_MULTIPLY(a BIGINT, b BIGINT)
	RETURNS BIGINT
  AS 
$$
  ((BITSHIFTLEFT(BITSHIFTRIGHT(A, 32) * B, 32) % 18446744073709551616) + (BITAND(A, 4294967295 ) * B)) % 18446744073709551616
$$
;;

CREATE OR REPLACE FUNCTION F_DD_HASH("idx" INT, "element" BIGINT)
	RETURNS BIGINT
  AS 
$$
  TO_NUMBER(F_DD_64BIT_MULTIPLY(
    (6148914691236517205 * BITXOR(element, BITSHIFTRIGHT(element, 32)) % 18446744073709551616), 
    CASE
      WHEN idx = 0 THEN 18269989962351869307
      WHEN idx = 1 THEN 9143901319630896501
      WHEN idx = 2 THEN 2072764263930962169
      WHEN idx = 3 THEN 417226483919003799
      WHEN idx = 4 THEN 16485935163296413021
    END))
$$
;;

CREATE OR REPLACE FUNCTION F_DD_TRAILING_ZEROS(element FLOAT)
  RETURNS FLOAT
  LANGUAGE JAVASCRIPT
  AS 
'
  if(ELEMENT == 0) return 0
  count = 0
  while((ELEMENT & 1) == 0) {
    ELEMENT = ELEMENT >>> 1
    count ++
  }
  return count
';